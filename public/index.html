<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>TV Party</title>
    <link href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
    <link href="http://twitter.github.io/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <style>
        #subscriptions label {
            padding: 10px;
            background-color:#f5f5f5;
        }
        #subscriptions label.checked {
            background-color:#5bb75b;
            color: #fff;
        }

    </style>
</head>
<body>
    <div class="container">
        <form>
            <fieldset>
                <legend>Subscriptions</legend>
                <p>Enable/disable subscriptions by checking the checkbox next to the show. If there are multiple listings for a show, be sure to check <a href=
                    "http://www.dailytvtorrents.org/show-list/">Daily TV Torrents</a> to see which is the good one.</p>
                <div id="toolbar" class="btn-toolbar">
                    <div class="btn-group">
                        <button class="cat btn active">1</button>
                        <button class="cat btn">2</button>
                        <button class="cat btn">3</button>
                        <button class="cat btn">4</button>
                        <button class="cat btn">5</button>
                        <button class="cat btn">6</button>
                        <button class="cat btn">7</button>
                        <button class="cat btn">8</button>
                        <button class="cat btn">9</button>
                        <button class="cat btn">a</button>
                        <button class="cat btn">b</button>
                        <button class="cat btn">c</button>
                        <button class="cat btn">d</button>
                        <button class="cat btn">e</button>
                        <button class="cat btn">f</button>
                        <button class="cat btn">g</button>
                        <button class="cat btn">h</button>
                        <button class="cat btn">i</button>
                    </div>
                    <div class="btn-group">
                        <button class="cat btn">j</button>
                        <button class="cat btn">k</button>
                        <button class="cat btn">l</button>
                        <button class="cat btn">m</button>
                        <button class="cat btn">n</button>
                        <button class="cat btn">o</button>
                        <button class="cat btn">p</button>
                        <button class="cat btn">q</button>
                        <button class="cat btn">r</button>
                        <button class="cat btn">s</button>
                        <button class="cat btn">t</button>
                        <button class="cat btn">u</button>
                        <button class="cat btn">v</button>
                        <button class="cat btn">w</button>
                        <button class="cat btn">x</button>
                        <button class="cat btn">y</button>
                        <button class="cat btn">z</button>
                    </div>
                </div>
                <div class="clearfix" id="subscriptions"><i class="icon-spinner icon-spin"></i> Please wait...</div>
            </fieldset>
        </form>
    </div>

    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script>
        $(function(){
            var subscriptions, shows;

            // show active shows
            var updateShows = function(){
                $('#subscriptions').html("");
                shows.forEach(function(show){
                    if (show.id[0] == $('.cat.btn.active').html()){
                        $('#subscriptions').append('<label class="span5 checkbox" id="' + show.id + '"><input name="' + show.id + '" type="checkbox" /><span>' + show.name + '</span></label>');
                    }
                });
            };

            // update the display of subscriptions
            var updateSubscription = function(){
                $('#subscriptions input').prop('checked', false);
                subscriptions.forEach(function(subscription){
                    $('#' + subscription.id + ' input').prop('checked', true);
                });
                $('input[type="checkbox"]').parent().removeClass("checked");
                $('input[type="checkbox"]:checked').parent().addClass("checked");
            }


            // fill in all the shows/subscriptions
            $.get('/shows', function(data){
                shows = data;
                updateShows();
                $.get('/subscriptions', function(data){
                    subscriptions = data;
                    updateSubscription();
                });
            });

            // on checkbox click, update subscription
            $("#subscriptions").on("change", "input", function(event){
                $('input[type="checkbox"]').parent().removeClass("checked");
                $('input[type="checkbox"]:checked').parent().addClass("checked");
                $.post('/subscriptions', {"id":event.target.name,"val":event.target.checked }, function(data){
                    console.log(arguments);
                    subscriptions = data;
                    updateSubscription();
                });
            });

            // paginate using first letter of shows
            $("#toolbar").on("click", ".cat", function(event){
                event.preventDefault();
                $('#toolbar .cat').removeClass('active');
                $(event.target).addClass('active');
                updateShows();
                updateSubscription();
            });
        });
    </script>

</body>
</html>